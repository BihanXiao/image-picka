Build the extension
===================

Preparation
-----------

1. The build system requires [Node.js](https://nodejs.org/en/). Make sure the `npm` binary is added to the `PATH` environment variable.
2. If you want to pull translation from https://www.transifex.com/, you have to install [Python](https://www.python.org/) then install the [official transifex CLI](https://docs.transifex.com/client/introduction).
3. Clone the repo, navigate to the project root, and run `npm install` to install all node.js dependencies.

Project structure
-----------------

* `.tx` - The configuration files for Transifex.
* `test` - A test server that can serve a sample image through a throttled connection.
* `extension` - The main extension folder.

  - `_locales` - Contains all translations.
    
    - To add a new message, modify `en/messages.json`.
    - To add a new translation, put the new `messages.json` to the corresponded folder then run `tx push -t` to push the new translation to Transifex.
    - To pull translations from Transifex, run `npm run build-locales`.
    
  - `background` - JS files used by the background page.
  - `content` - JS files used by the content script.
  - `css` - CSS files shared by extension/options pages.
  - `lib` - JS files shared by content scripts, background page, and extension/options pages.
  - `options` - The options page.
  - `picker` - The batch download UI.
  - `public` - Some assets that are public for page scripts.
  - `vendor` - 3rd-party libraries. These files are generated by the `npm run build-vendor` command. Don't modify these files directly.
  
Generate the ZIP file for AMO
-----------------------------

Before generating the ZIP file, you may want to:

1. Update locales - Run `npm run build-locales`.
2. Update 3rd-party libraries - Run `npm run build-vendor`.
3. Make sure there is no error in the extension - Run `npm test`.

To generate the ZIP file, run `npx web-ext build`.

Push a new release to Github
----------------------------

A release is just a commit tagged with a specific version. Before bumping the version, you should:

1. Make sure you are on the master branch.
2. Update the changelog in README.md.
3. Commit all the changes.

To bump the version, run [`npm version <newversion>` command](https://docs.npmjs.com/cli/version). After bumping the version, the script would push the tagged commit to remote. The script would also generage a ZIP file that can be uploaded to AMO.
